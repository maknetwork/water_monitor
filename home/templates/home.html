{% extends "base.html" %}
{%block selected1%}active{%endblock%}
{% load static %}

{% block content %}
<link rel="stylesheet" type="text/css" href="{% static "assets/css/forms/switches.css" %}">
<div id="content" class="main-content">
         <div class="layout-px-spacing">

             <div class="row layout-top-spacing">



               <div class="col-xl-4 col-lg-6 col-md-6 col-sm-12 col-12 layout-spacing">
                   <div class="widget widget-table-one">
                       <div class="widget-heading">
                           <h5 class="">Devices </h5>
                       </div>

                       <div class="widget-content">
{%if devices%}
                         {%for device in devices%}

                           <div class="transactions-list">
                               <div class="t-item">
                                   <div class="t-company-name">

                                       <div class="t-icon">
                                           <div class="icon">
                                               <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-home"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                                           </div>
                                       </div>

                                       <div class="t-name">
                                           <h4>{{device.title}} {{device.get_moisture}}</h4>
                                           <p class="meta-date">{{device.ipaddress}}</p>
                                       </div>
                                   </div>
                                   <div class="t-rate rate-dec">
                                       {%if device.connected%}<span class="badge badge-success"> Online last checked on {{device.last_seen}} </span>

{%else%}<span class="badge badge-danger"> Offline last checked on {{device.last_seen}}</span>{%endif%}                                   </div>
                               </div>
                           </div>{%endfor%}

{%else%}

                           <div class="transactions-list">
                               <div class="t-item">
                                   <div class="t-company-name">

                                       <div class="t-icon">
                                           <div class="icon">
                                               <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-home"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                                           </div>
                                       </div>

                                       <div class="t-name">
                                           <h4>No devices connected</h4>
                                           <p class="meta-date"></p>
                                       </div>
                                   </div>
                                   <div class="t-rate rate-dec">
                                       <p><span>-$16.44</span> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-down"><line x1="12" y1="5" x2="12" y2="19"></line><polyline points="19 12 12 19 5 12"></polyline></svg></p>
                                   </div>
                               </div>
                           </div>
{%endif%}
                       </div>
                   </div>
               </div>



                 <div class="col-xl-4 col-lg-6 col-md-6 col-sm-6 col-12 layout-spacing">
                     <div class="widget-three">
                         <div class="widget-heading">
                             <h5 class="">Minimum moisture levels</h5>
                         </div>
                         <div class="widget-content">

                             <div class="order-summary">


                                 {%for zone in zones%}

                                 <div class="summary-list">
                                     <div class="w-icon">
                                         <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg>
                                     </div>
                                     <div class="w-summary-details">

                                         <div class="w-summary-info">
                                             <h6>{{zone.name}}</h6>
                                             <p class="summary-count">{{zone.min_moisture}} %</p>
                                         </div>

                                         <div class="w-summary-stats">
                                             <div class="progress">
                                                 <div class="progress-bar bg-gradient-success" role="progressbar" style="width: {{zone.min_moisture}}%" aria-valuenow="{{zone.min_moisture}}" aria-valuemin="0" aria-valuemax="100"></div>
                                             </div>
                                         </div>

                                     </div>

                                 </div>
{%endfor%}


                             </div>

                         </div>
                     </div>
                 </div>

                 <div class="col-xl-4 col-lg-6 col-md-6 col-sm-6 col-12 layout-spacing">
                     <div class="widget-three">
                         <div class="widget-heading">
                             <h5 class="">Last recorded moisture</h5>
                         </div>
                         <div class="widget-content">

                             <div class="order-summary">


                                 {%for zone in zones%}

                                 <div class="summary-list">
                                     <div class="w-icon">
                                         <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg>
                                     </div>
                                     <div class="w-summary-details">

                                         <div class="w-summary-info">
                                             <h6>{{zone.name}} on {{zone.last_measured}}</h6>
                                             <p class="summary-count">{{zone.last_measured_moisture}} %</p>
                                         </div>

                                         <div class="w-summary-stats">
                                             <div class="progress">
                                                 <div class="progress-bar bg-gradient-success" role="progressbar" style="width: {{zone.last_measured_moisture}}%" aria-valuenow="{{zone.last_measured_moisture}}" aria-valuemin="0" aria-valuemax="100"></div>
                                             </div>
                                         </div>

                                     </div>

                                 </div>
{%endfor%}


                             </div>

                         </div>
                     </div>
                 </div>
                 <div class="col-xl-5 col-lg-12 col-md-6 col-sm-12 col-12 layout-spacing">

                     <div class="widget widget-table-two">

                         <div class="widget-heading">
                             <h5 class="">Activate monitoring</h5>
                         </div>

                         <div class="widget-content">
                           <form method="get" action="/save_status">
                             <div class="table-responsive">
                                 <table class="table">
                                     <thead>
                                         <tr>
                                             <th><div class="th-content">Zone name</div></th>
                                             <th><div class="th-content">Last Measured on</div></th>
                                             <th><div class="th-content">Last measured moisture</div></th>
                                             <th><div class="th-content">Measuring status</div></th>
                                         </tr>
                                     </thead>
                                     <tbody>
                                  {%for zone in zones%}
                                         <tr>
                                             <td><div class="td-content customer-name">{{zone.name}}</div></td>
                                             <td><div class="td-content product-brand">{{zone.last_measured}}</div></td>
                                             <td><div class="td-content">{{zone.last_measured_moisture}}</div></td>
                                             <td><div class="td-content">

                                               {%if zone.monitoring%}<label class="switch s-icons s-outline  s-outline-success  mb-4 mr-2">
                                                <input type="checkbox" value="{{zone.pk}}" name="zone_id" checked>

                                                <span class="slider round"></span>
                                            </label> {%else%}<label class="switch s-icons s-outline  s-outline-success  mb-4 mr-2">
                                             <input type="checkbox" value="{{zone.pk}}"  name="zone_id">

                                             <span class="slider round"></span>
                                         </label> {%endif%}</div></td>
                                         </tr>
                                      {%endfor%}
                                     </tbody>
                                 </table>
                             </div>
                             <div class="inv-action">
                               <button class="btn btn-dark mb-2" type="submit">Save</button>
                                      <a href="/edit_zone" class="btn btn-danger">Edit zone</a>
                                  </div>

                                  </form>
                         </div>
                     </div>
                 </div>


      






             </div>

         </div>
     </div>
{%endblock%}

{%block footer%}
<script>

$(document).ready(function (){

  var sLineArea = {
      chart: {
          height: 350,
          type: 'area',
          toolbar: {
            show: false,
          }
      },
      dataLabels: {
          enabled: false
      },
      stroke: {
          curve: 'smooth'
      },
      series: [{
         name: 'series1',
         data: {{ labels|safe }}
     }],

      xaxis: {
          type: 'datetime',
          labels: {
   format: 'HH:mm',
 },
          categories:{{ data|safe }},
      },
      tooltip: {
            shared: true,
            intersect: false,
            y: {
              formatter: function (y) {
                if (typeof y !== "undefined") {
                  return y.toFixed(0) + " points";
                }
                return y;

              }
            },
            x:{
              format:'HH:mm'
            }
          }
  }

  var chart = new ApexCharts(
      document.querySelector("#s-line-area2"),
      sLineArea
  );

  chart.render();
});


</script>

{%endblock%}
